{"version":3,"names":["init","instance","chartData","utils_getnodeinfo","getNodeInfo","then","res","_res$","ctxW","width","ctxH","height","ctx","common_vendor","index","createCanvasContext","data","_toConsumableArray2","Set","map","item","date","split","setFillStyle","setFontSize","total","reduce","acc","_ref","expense","fillText","toFixed","yMin","yMax","beginPath","strokeStyle","lineWidth","moveTo","lineTo","stroke","setLineDash","space","weekStrings","i","textAlign","x","forEach","_ref2","setTextAlign","maxY","Math","max","apply","points","y","__f__","point","arc","PI","fillStyle","fill","draw"],"sources":["chartIndex.js"],"sourcesContent":["import { getNodeInfo } from \"./getnodeinfo\"\n\n// 初始化图表\nexport const init = (instance,chartData)=>{\n\t// 获取canvas的宽和高\r\n\t\r\n\tgetNodeInfo(instance,'.barChart').then(res=>{\r\n\t\tconst {width:ctxW,height:ctxH} = res[0]\r\n\t\t// 绘制图形\r\n\t\tconst ctx = uni.createCanvasContext('barChart',instance)\r\n\t\t\r\n\t\tconst data = [...new Set(chartData.map(item =>item.date.split(/[-]/)[1]+'-'+item.date.split(/[-]/)[2]))]\r\n\t\t\r\n\t\t// 标题\r\n\t\tctx.setFillStyle('#282C35')\r\n\t\tctx.setFontSize(14)\r\n\t\tconst total = chartData.reduce((acc,{expense}) => acc+expense,0)  //总支出 \r\n\t\tctx.fillText(\"总支出：\"+total,(ctxH/10).toFixed(0),(ctxW/20).toFixed(0))\r\n\t\tctx.setFontSize(12)\r\n\t\tctx.fillText(\"平均值：\"+(total/7).toFixed(2),(ctxH/10).toFixed(0),(ctxW/10).toFixed(0))\r\n\t\t\r\n\t\t\r\n\t\tconst yMin= 50 //折线图上边缘\r\n\t\tconst yMax = ctxH - 30 //折线图下边缘\r\n\t\t\r\n\t\t// 上实线\r\n\t\tctx.beginPath()\r\n\t\tctx.strokeStyle = '#E3E3E5'\r\n\t\tctx.lineWidth = 1\r\n\t\tctx.moveTo(0,yMin)\r\n\t\tctx.lineTo(ctxW,yMin)\r\n\t\t\r\n\t\t// 下实线\r\n\t\tctx.moveTo(0,yMax)\r\n\t\tctx.lineTo(ctxW,yMax)\r\n\t\tctx.stroke()\r\n\t\t\r\n\t\t// 中虚线\r\n\t\tctx.beginPath()\r\n\t\tctx.setLineDash([2,4]) //虚线样式 2px 的实线 3px 的空白\r\n\t\tctx.strokeStyle = '#E3E3E5'\r\n\t\tctx.lineWidth = 1\r\n\t\tctx.moveTo(0,(yMax+yMin)/2)\r\n\t\tctx.lineTo(ctxW,(yMax+yMin)/2)\r\n\t\tctx.stroke()\r\n\t\t\r\n\t\t// 底部标题\r\n\t\tconst space = ctxW/8 //标题间隔大小\r\n\t\t// 生成日期配置\r\n\t\tconst weekStrings = data.map((date,i) => {\r\n\t\t\tconst textAlign = 'center'\r\n\t\t\treturn {\r\n\t\t\t\tdate,\r\n\t\t\t\ttextAlign,\r\n\t\t\t\tx:(i+1)*space\r\n\t\t\t}\r\n\t\t})\r\n\t\tctx.setFontSize(10)\r\n\t\t\r\n\t\t// 循环绘制日期标签\r\n\t\tweekStrings.forEach(({date,textAlign,x}) => {\r\n\t\t\tctx.setTextAlign(textAlign)\r\n\t\t\tctx.fillText(date, x, yMax+15, space);\r\n\t\t})\r\n\t\t\r\n\t\t// 绘制坐标点\r\n\t\tconst maxY = Math.max(...chartData.map(item => item.expense)) //支出的最大值\r\n\t\tconst points = chartData.map((item,i) =>{\r\n\t\t\treturn {\r\n\t\t\t\tx:(i+1)*space,\r\n\t\t\t\ty:((yMax-yMin)*(1-item.expense/maxY)+yMin).toFixed(1),\r\n\t\t\t\texpense:item.expense\r\n\t\t\t}\r\n\t\t})\r\n\t\tconsole.log(points);\r\n\t\t\r\n\t\tctx.beginPath();\r\n\t\tctx.lineWidth = 0.3\r\n\t\tctx.moveTo(points[0].x, points[0].y);\r\n\t\tpoints.forEach(point => ctx.lineTo(point.x, point.y));\r\n\t\tctx.strokeStyle = '#282C35'\r\n\t\tctx.setLineDash([1,0])\r\n\t\tctx.stroke();\r\n\t\t\r\n\t\tpoints.forEach(point => {\r\n\t\t  ctx.beginPath();\r\n\t\t  ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);\r\n\t\t  ctx.fillStyle = 'blue';\r\n\t\t  ctx.fill();\r\n\t\t  ctx.lineWidth = 0.3\r\n\t\t  ctx.fillText(point.expense, point.x,point.y);\r\n\t\t});\r\n\t\t\r\n\t\t// 绘制\r\n\t\tctx.draw();\r\n\t})\n}"],"mappings":";;;;;;AAGY,IAACA,IAAA,GAAO,SAAPA,KAAQC,QAAA,EAASC,SAAA,EAAY;EAGzCC,iBAAA,CAAAC,WAAA,CAAYH,QAAA,EAAS,WAAW,EAAEI,IAAA,CAAK,UAAAC,GAAA,EAAK;IAC3C,IAAAC,KAAA,GAAiCD,GAAA,CAAI,CAAC;MAAzBE,IAAA,GAAAD,KAAA,CAANE,KAAA;MAAkBC,IAAA,GAAAH,KAAA,CAAPI,MAAA;IAElB,IAAMC,GAAA,GAAMC,aAAA,CAAGC,KAAA,CAACC,mBAAA,CAAoB,YAAWd,QAAQ;IAEvD,IAAMe,IAAA,GAAAC,mBAAA,CAAW,IAAIC,GAAA,CAAIhB,SAAA,CAAUiB,GAAA,CAAI,UAAAC,IAAA;MAAA,OAAOA,IAAA,CAAKC,IAAA,CAAKC,KAAA,CAAM,KAAK,EAAE,CAAC,IAAE,MAAIF,IAAA,CAAKC,IAAA,CAAKC,KAAA,CAAM,KAAK,EAAE,CAAC,CAAC;IAAA,EAAC,CAAC;IAGvGV,GAAA,CAAIW,YAAA,CAAa,SAAS;IAC1BX,GAAA,CAAIY,WAAA,CAAY,EAAE;IAClB,IAAMC,KAAA,GAAQvB,SAAA,CAAUwB,MAAA,CAAO,UAACC,GAAA,EAAAC,IAAA;MAAA,IAAKC,OAAA,GAAAD,IAAA,CAAAC,OAAA;MAAA,OAAaF,GAAA,GAAIE,OAAA;IAAA,GAAQ,CAAC;IAC/DjB,GAAA,CAAIkB,QAAA,CAAS,SAAOL,KAAA,GAAOf,IAAA,GAAK,IAAIqB,OAAA,CAAQ,CAAC,IAAGvB,IAAA,GAAK,IAAIuB,OAAA,CAAQ,CAAC,CAAC;IACnEnB,GAAA,CAAIY,WAAA,CAAY,EAAE;IAClBZ,GAAA,CAAIkB,QAAA,CAAS,UAAQL,KAAA,GAAM,GAAGM,OAAA,CAAQ,CAAC,IAAGrB,IAAA,GAAK,IAAIqB,OAAA,CAAQ,CAAC,IAAGvB,IAAA,GAAK,IAAIuB,OAAA,CAAQ,CAAC,CAAC;IAGlF,IAAMC,IAAA,GAAM;IACZ,IAAMC,IAAA,GAAOvB,IAAA,GAAO;IAGpBE,GAAA,CAAIsB,SAAA,EAAW;IACftB,GAAA,CAAIuB,WAAA,GAAc;IAClBvB,GAAA,CAAIwB,SAAA,GAAY;IAChBxB,GAAA,CAAIyB,MAAA,CAAO,GAAEL,IAAI;IACjBpB,GAAA,CAAI0B,MAAA,CAAO9B,IAAA,EAAKwB,IAAI;IAGpBpB,GAAA,CAAIyB,MAAA,CAAO,GAAEJ,IAAI;IACjBrB,GAAA,CAAI0B,MAAA,CAAO9B,IAAA,EAAKyB,IAAI;IACpBrB,GAAA,CAAI2B,MAAA,EAAQ;IAGZ3B,GAAA,CAAIsB,SAAA,EAAW;IACftB,GAAA,CAAI4B,WAAA,CAAY,CAAC,GAAE,CAAC,CAAC;IACrB5B,GAAA,CAAIuB,WAAA,GAAc;IAClBvB,GAAA,CAAIwB,SAAA,GAAY;IAChBxB,GAAA,CAAIyB,MAAA,CAAO,IAAGJ,IAAA,GAAKD,IAAA,IAAM,CAAC;IAC1BpB,GAAA,CAAI0B,MAAA,CAAO9B,IAAA,GAAMyB,IAAA,GAAKD,IAAA,IAAM,CAAC;IAC7BpB,GAAA,CAAI2B,MAAA,EAAQ;IAGZ,IAAME,KAAA,GAAQjC,IAAA,GAAK;IAEnB,IAAMkC,WAAA,GAAc1B,IAAA,CAAKG,GAAA,CAAI,UAACE,IAAA,EAAKsB,CAAA,EAAM;MACxC,IAAMC,SAAA,GAAY;MAClB,OAAO;QACNvB,IAAA,EAAAA,IAAA;QACAuB,SAAA,EAAAA,SAAA;QACAC,CAAA,GAAGF,CAAA,GAAE,KAAGF;MACR;IACJ,CAAG;IACD7B,GAAA,CAAIY,WAAA,CAAY,EAAE;IAGlBkB,WAAA,CAAYI,OAAA,CAAQ,UAAAC,KAAA,EAAwB;MAAA,IAAtB1B,IAAA,GAAA0B,KAAA,CAAA1B,IAAA;QAAKuB,SAAA,GAAAG,KAAA,CAAAH,SAAA;QAAUC,CAAA,GAAAE,KAAA,CAAAF,CAAA;MACpCjC,GAAA,CAAIoC,YAAA,CAAaJ,SAAS;MAC1BhC,GAAA,CAAIkB,QAAA,CAAST,IAAA,EAAMwB,CAAA,EAAGZ,IAAA,GAAK,IAAIQ,KAAK;IACvC,CAAG;IAGD,IAAMQ,IAAA,GAAOC,IAAA,CAAKC,GAAA,CAAAC,KAAA,CAALF,IAAA,EAAAjC,mBAAA,CAAYf,SAAA,CAAUiB,GAAA,CAAI,UAAAC,IAAA;MAAA,OAAQA,IAAA,CAAKS,OAAO;IAAA,EAAC;IAC5D,IAAMwB,MAAA,GAASnD,SAAA,CAAUiB,GAAA,CAAI,UAACC,IAAA,EAAKuB,CAAA,EAAK;MACvC,OAAO;QACNE,CAAA,GAAGF,CAAA,GAAE,KAAGF,KAAA;QACRa,CAAA,IAAIrB,IAAA,GAAKD,IAAA,KAAO,IAAEZ,IAAA,CAAKS,OAAA,GAAQoB,IAAA,IAAMjB,IAAA,EAAMD,OAAA,CAAQ,CAAC;QACpDF,OAAA,EAAQT,IAAA,CAAKS;MACb;IACJ,CAAG;IACDhB,aAAA,CAAAC,KAAA,CAAYyC,KAAA,qCAAAF,MAAM;IAElBzC,GAAA,CAAIsB,SAAA,EAAS;IACbtB,GAAA,CAAIwB,SAAA,GAAY;IAChBxB,GAAA,CAAIyB,MAAA,CAAOgB,MAAA,CAAO,CAAC,EAAER,CAAA,EAAGQ,MAAA,CAAO,CAAC,EAAEC,CAAC;IACnCD,MAAA,CAAOP,OAAA,CAAQ,UAAAU,KAAA;MAAA,OAAS5C,GAAA,CAAI0B,MAAA,CAAOkB,KAAA,CAAMX,CAAA,EAAGW,KAAA,CAAMF,CAAC,CAAC;IAAA;IACpD1C,GAAA,CAAIuB,WAAA,GAAc;IAClBvB,GAAA,CAAI4B,WAAA,CAAY,CAAC,GAAE,CAAC,CAAC;IACrB5B,GAAA,CAAI2B,MAAA,EAAM;IAEVc,MAAA,CAAOP,OAAA,CAAQ,UAAAU,KAAA,EAAS;MACtB5C,GAAA,CAAIsB,SAAA,EAAS;MACbtB,GAAA,CAAI6C,GAAA,CAAID,KAAA,CAAMX,CAAA,EAAGW,KAAA,CAAMF,CAAA,EAAG,GAAG,GAAGJ,IAAA,CAAKQ,EAAA,GAAK,CAAC;MAC3C9C,GAAA,CAAI+C,SAAA,GAAY;MAChB/C,GAAA,CAAIgD,IAAA,EAAI;MACRhD,GAAA,CAAIwB,SAAA,GAAY;MAChBxB,GAAA,CAAIkB,QAAA,CAAS0B,KAAA,CAAM3B,OAAA,EAAS2B,KAAA,CAAMX,CAAA,EAAEW,KAAA,CAAMF,CAAC;IAC/C,CAAG;IAGD1C,GAAA,CAAIiD,IAAA,EAAI;EACV,CAAE;AACF","ignoreList":[]}