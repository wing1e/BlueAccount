{"version":3,"file":"bar-chart.js","sources":["utils/chart/bar-chart.js"],"sourcesContent":["import {\r\n\tgetNodeInfo\r\n} from '../node-info'\r\nimport {\r\n\tCHART_STYLES,\r\n\tAXIS_MARGIN,\r\n\tdrawGridLines,\r\n\tcalculateY\r\n} from \"./chart.js\"\r\n\r\nexport const barChartInit = async (instance, chartData, className, canvasId) => {\r\n\ttry {\r\n\t\t// 获取画布尺寸\r\n\t\tconst canvasNode = await getNodeInfo(instance, className)\r\n\r\n\t\tconst {\r\n\t\t\twidth: ctxW,\r\n\t\t\theight: ctxH\r\n\t\t} = canvasNode[0]\r\n\r\n\t\t// 创建绘图上下文\r\n\t\tconst ctx = uni.createCanvasContext(canvasId, instance)\r\n\r\n\t\t// 计算绘图区域\r\n\t\tconst drawArea = {\r\n\t\t\ttop: AXIS_MARGIN.top,\r\n\t\t\tbottom: ctxH - AXIS_MARGIN.bottom,\r\n\t\t\tget center() {\r\n\t\t\t\treturn (this.top + this.bottom) / 2\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 绘制网格系统\r\n\t\tdrawGridLines(ctx, ctxW, drawArea)\r\n\r\n\t\t// 绘制底部标签\r\n\t\tdrawBottomLabels(ctx, ctxW, drawArea.bottom, chartData, \"bar\")\r\n\r\n\t\tconst BarSpace = ctxW / 25;\r\n\r\n\t\tconst MaxValue = Math.max(...chartData.map(item => item.expense))\r\n\r\n\t\tconst points = chartData.map((item, index) => ({\r\n\t\t\tx: (2 * index + 1) * BarSpace,\r\n\t\t\ty: calculateY(item.expense, MaxValue, drawArea),\r\n\t\t\tvalue: item.expense\r\n\t\t}))\r\n\r\n\t\tpoints.forEach(item => {\r\n\t\t\tctx.fillRect(item.x, item.y, BarSpace, drawArea.bottom - item.y)\r\n\t\t\tctx.setFillStyle('#de6ea6')\r\n\t\t})\r\n\r\n\t\tctx.draw()\r\n\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t}\r\n}\r\n\r\n/* 绘制底部日期标签 */\r\nconst drawBottomLabels = (ctx, canvasWidth, bottomY, data) => {\r\n\tconst labelSpace = canvasWidth / 25 // 间距\r\n\r\n\tctx.save()\r\n\tctx.setFontSize(CHART_STYLES.label.fontSize)\r\n\tctx.fillStyle = CHART_STYLES.label.color\r\n\tdata.forEach((item, index) => {\r\n\t\tconst dateStr = item.date.split('-')[1] // 提取DD\r\n\t\tconst xPos = (2 * index + 1) * labelSpace\r\n\t\tctx.setTextAlign('center')\r\n\t\tctx.fillText(dateStr, xPos, bottomY + 15) // 下移15px避免重叠\r\n\t})\r\n\r\n\tctx.restore()\r\n}"],"names":["getNodeInfo","uni","AXIS_MARGIN","drawGridLines","calculateY","CHART_STYLES"],"mappings":";;;;AAUY,MAAC,eAAe,OAAO,UAAU,WAAW,WAAW,aAAa;AAC/E,MAAI;AAEH,UAAM,aAAa,MAAMA,2BAAY,UAAU,SAAS;AAExD,UAAM;AAAA,MACL,OAAO;AAAA,MACP,QAAQ;AAAA,IACX,IAAM,WAAW,CAAC;AAGhB,UAAM,MAAMC,cAAG,MAAC,oBAAoB,UAAU,QAAQ;AAGtD,UAAM,WAAW;AAAA,MAChB,KAAKC,kBAAW,YAAC;AAAA,MACjB,QAAQ,OAAOA,kBAAAA,YAAY;AAAA,MAC3B,IAAI,SAAS;AACZ,gBAAQ,KAAK,MAAM,KAAK,UAAU;AAAA,MAClC;AAAA,IACD;AAGDC,oCAAc,KAAK,MAAM,QAAQ;AAGjC,qBAAiB,KAAK,MAAM,SAAS,QAAQ,WAAW,KAAK;AAE7D,UAAM,WAAW,OAAO;AAExB,UAAM,WAAW,KAAK,IAAI,GAAG,UAAU,IAAI,UAAQ,KAAK,OAAO,CAAC;AAEhE,UAAM,SAAS,UAAU,IAAI,CAAC,MAAM,WAAW;AAAA,MAC9C,IAAI,IAAI,QAAQ,KAAK;AAAA,MACrB,GAAGC,kBAAAA,WAAW,KAAK,SAAS,UAAU,QAAQ;AAAA,MAC9C,OAAO,KAAK;AAAA,IACf,EAAI;AAEF,WAAO,QAAQ,UAAQ;AACtB,UAAI,SAAS,KAAK,GAAG,KAAK,GAAG,UAAU,SAAS,SAAS,KAAK,CAAC;AAC/D,UAAI,aAAa,SAAS;AAAA,IAC7B,CAAG;AAED,QAAI,KAAM;AAAA,EAEV,SAAQ,KAAK;AACbH,kBAAAA,MAAY,MAAA,OAAA,kCAAA,GAAG;AAAA,EACf;AACF;AAGA,MAAM,mBAAmB,CAAC,KAAK,aAAa,SAAS,SAAS;AAC7D,QAAM,aAAa,cAAc;AAEjC,MAAI,KAAM;AACV,MAAI,YAAYI,+BAAa,MAAM,QAAQ;AAC3C,MAAI,YAAYA,+BAAa,MAAM;AACnC,OAAK,QAAQ,CAAC,MAAM,UAAU;AAC7B,UAAM,UAAU,KAAK,KAAK,MAAM,GAAG,EAAE,CAAC;AACtC,UAAM,QAAQ,IAAI,QAAQ,KAAK;AAC/B,QAAI,aAAa,QAAQ;AACzB,QAAI,SAAS,SAAS,MAAM,UAAU,EAAE;AAAA,EAC1C,CAAE;AAED,MAAI,QAAS;AACd;;"}