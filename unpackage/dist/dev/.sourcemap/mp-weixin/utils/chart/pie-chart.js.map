{"version":3,"file":"pie-chart.js","sources":["utils/chart/pie-chart.js"],"sourcesContent":["import {\r\n\tgetNodeInfo\r\n} from \"../node-info.js\";\r\n\r\nexport const EXPENSE_TYPE = [{\r\n\t\t\"category\": \"购物\",\r\n\t\t\"color\": \"#00B6E6\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"餐饮\",\r\n\t\t\"color\": \"#FF6B6B\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"交通\",\r\n\t\t\"color\": \"#4CAF50\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"住房\",\r\n\t\t\"color\": \"#FFA726\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"娱乐\",\r\n\t\t\"color\": \"#9C27B0\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"医疗\",\r\n\t\t\"color\": \"#F44336\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"教育\",\r\n\t\t\"color\": \"#2196F3\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"投资\",\r\n\t\t\"color\": \"#FFD700\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"工资\",\r\n\t\t\"color\": \"#4CAF50\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"旅行\",\r\n\t\t\"color\": \"#E91E63\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"礼物\",\r\n\t\t\"color\": \"#FF4081\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"其他\",\r\n\t\t\"color\": \"#9E9E9E\"\r\n\t}\r\n]\r\n\r\nexport const INCOME_TYPE = [{\r\n\t\t\"category\": \"工资\",\r\n\t\t\"color\": \"#4CAF50\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"奖金\",\r\n\t\t\"color\": \"#9C27B0\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"兼职\",\r\n\t\t\"color\": \"#E91E63\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"理财\",\r\n\t\t\"color\": \"#FFC107\"\r\n\t},\r\n\t{\r\n\t\t\"category\": \"其他收入\",\r\n\t\t\"color\": \"#9E9E9E\"\r\n\t}\r\n]\r\n\r\nconst LABEL_CONFIG = {\r\n    LINE_OFFSET: 20,   // 折线延伸长度\r\n    LABEL_OFFSET: 30  // 标签与折线拐点间距\r\n};\r\n\r\nexport const pieCharInit = async (instance, chartData, className, canvasId) => {\r\n\ttry {\r\n\t\tconst canvasNode = await getNodeInfo(instance, className)\r\n\t\tconst {\r\n\t\t\theight: ctxH,\r\n\t\t\twidth: ctxW\r\n\t\t} = canvasNode[0]\r\n\t\tconst ctx = uni.createCanvasContext(canvasId, instance)\r\n\r\n\t\tconst centerX = ctxW / 2 //圆心X坐标\r\n\t\tconst centerY = ctxH / 2 //圆心Y坐标\r\n\t\tconst outerR = ctxH / 3 //外圆半径 \r\n\t\tconst innerR = ctxH / 4 //内圆半径\r\n\r\n\r\n\t\tconst expense = new Map(Object.entries(chartData.expense)); // 支出数据\r\n\t\t// const income = new Map(Object.entries(chartData.income)); // 收入数据\r\n\r\n\t\tlet startAngle = -Math.PI / 2; // 起始角度从12点方向开始\r\n\r\n\t\texpense.forEach((val, key) => {\r\n\r\n\t\t\tconst sliceAngle = val / 100 * 2 * Math.PI;\r\n\t\t\tconst endAngle = startAngle + sliceAngle;\r\n\r\n\t\t\t// 绘制路径\r\n\t\t\tctx.beginPath();\r\n\t\t\t// 外圆弧（顺时针）\r\n\t\t\tctx.arc(centerX, centerY, outerR, startAngle, endAngle, false);\r\n\t\t\t// 内圆弧（逆时针返回，形成闭合环）\r\n\t\t\tctx.arc(centerX, centerY, innerR, endAngle, startAngle, true);\r\n\t\t\tctx.closePath();\r\n\t\t\t// 设置填充颜色\r\n\t\t\tctx.setFillStyle(EXPENSE_TYPE.find(item => item.category === key).color);\r\n\t\t\tctx.fill();\r\n\r\n\t\t\t// 百分比大于5显示标签\r\n\t\t\tif (Number(val) >= 5) {\r\n\t\t\t\tconst midAngle = startAngle + sliceAngle / 2;\r\n\t\t\t\tconst isRight = Math.cos(midAngle) > 0;// 判断扇形是否在右侧\r\n\t\t\t\t// 计算折线起点（外圆弧中点）\r\n\t\t\t\tconst lineStartX = centerX + outerR * Math.cos(midAngle);\r\n\t\t\t\tconst lineStartY = centerY + outerR * Math.sin(midAngle);\r\n\r\n\t\t\t\t// 计算折线拐点 \r\n\t\t\t\tconst lineBreakX = centerX + (outerR + LABEL_CONFIG.LINE_OFFSET) * Math.cos(midAngle);\r\n\t\t\t\tconst lineBreakY = centerY + (outerR + LABEL_CONFIG.LINE_OFFSET) * Math.sin(midAngle);\r\n\t\t\t\t\r\n\t\t\t\t// 标签\r\n\t\t\t\tconst labelX = isRight \r\n\t\t\t\t? lineBreakX + LABEL_CONFIG.LABEL_OFFSET\r\n\t\t\t\t: lineBreakX - LABEL_CONFIG.LABEL_OFFSET;\r\n\t\t\t\tconst labelY = lineBreakY\r\n\t\t\t\t// 绘制折线\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(lineStartX, lineStartY); // 起点：扇形边缘中点\r\n\t\t\t\tif (Math.cos(midAngle) > 0) {\r\n\t\t\t\t\t// 右侧扇区：向右水平延伸\r\n\t\t\t\t\tctx.lineTo(lineBreakX, lineBreakY); // 水平转折\r\n\t\t\t\t\tctx.lineTo(lineBreakX + LABEL_CONFIG.LINE_OFFSET, lineBreakY); // 向右延伸\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 左侧扇区：向左水平延伸\r\n\t\t\t\t\tctx.lineTo(lineBreakX, lineBreakY); // 水平转折\r\n\t\t\t\t\tctx.lineTo(lineBreakX - LABEL_CONFIG.LINE_OFFSET, lineBreakY);// 向左延伸\r\n\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctx.setStrokeStyle('#282C35'); // 折线颜色与扇区一致\r\n\t\t\t\tctx.setLineWidth(1);\r\n\t\t\t\tctx.stroke();\r\n\r\n\t\t\t\tconst colorMap = new Map(EXPENSE_TYPE.map(item => [item.category, item.color]));\r\n\t\t\t\tconst textAlign = isRight ? 'left' : 'right'; // 文本对齐方式\r\n\t\t\t\t// 绘制文本\r\n\t\t\t\tdrawLabelText(ctx, `${key} ${Number(val).toFixed(1)}%`, labelX, labelY, textAlign, colorMap.get(key));\r\n\t\t\t}\r\n\r\n\t\t\tstartAngle = endAngle; // 更新起始角度\r\n\t\t});\r\n\r\n\t\t// 执行绘制\r\n\t\tctx.draw();\r\n\r\n\t} catch (error) {\r\n\t\tconsole.log(error);\r\n\t}\r\n}\r\nconst drawLabelText = (ctx, text, x, y, align, color) => {\r\n    ctx.save();\r\n    ctx.setFontSize(12);\r\n    ctx.setFillStyle(color);\r\n    ctx.setTextAlign(align);\r\n    ctx.setTextBaseline('middle');\r\n    ctx.fillText(text, x, y);\r\n    ctx.restore();\r\n};\r\n"],"names":["getNodeInfo","uni"],"mappings":"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"}